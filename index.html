
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Trivo Store Diagn√≥stico Total Final</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 20px; }
    h1 { color: #333; }
    .estado { font-weight: bold; margin: 10px 0; }
    .ok { color: green; }
    .error { color: red; }
    .warn { color: orange; }
  </style>
</head>
<body>
  <h1>üîé Trivo Store ‚Äì Diagn√≥stico Total Final</h1>
  <div id="estadoConexion" class="estado">‚è≥ Verificando conexi√≥n a Supabase...</div>
  <div id="estadoTabla" class="estado">‚è≥ Verificando tabla 'mercancilla'...</div>
  <div id="estadoDatos" class="estado">‚è≥ Cargando productos...</div>
  <div id="lista-productos"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabaseUrl = "https://uzqmsbkjontizhovxajx.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6cW1zYmtqb250aXpob3h2YWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDY1NjYsImV4cCI6MjA2Mzg4MjU2Nn0.RtiBzB0k0qzFzsfgUZcIvW1eyu2VmVbEolCWQDkDwbU";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function diagnosticoTotal() {
      const estadoConexion = document.getElementById("estadoConexion");
      const estadoTabla = document.getElementById("estadoTabla");
      const estadoDatos = document.getElementById("estadoDatos");
      const lista = document.getElementById("lista-productos");

      try {
        estadoConexion.textContent = "üîå Conectando a Supabase...";
        const prueba = await supabase.from("mercancilla").select("*").limit(1);

        if (prueba.error) {
          estadoConexion.textContent = "‚ùå Error al conectar a Supabase.";
          estadoConexion.className = "estado error";
          console.error("Error conexi√≥n Supabase:", prueba.error.message);
          return;
        }

        estadoConexion.textContent = "‚úÖ Conexi√≥n a Supabase exitosa.";
        estadoConexion.className = "estado ok";

        if (!Array.isArray(prueba.data)) {
          estadoTabla.textContent = "‚ùå La tabla 'mercancilla' no es v√°lida.";
          estadoTabla.className = "estado error";
          return;
        }

        estadoTabla.textContent = "‚úÖ Tabla 'mercancilla' detectada.";
        estadoTabla.className = "estado ok";

        if (prueba.data.length === 0) {
          estadoDatos.textContent = "‚ö†Ô∏è Conexi√≥n OK pero no hay productos.";
          estadoDatos.className = "estado warn";
          return;
        }

        const { data, error } = await supabase.from("mercancilla").select("*");
        if (error) {
          estadoDatos.textContent = "‚ùå Error al cargar productos.";
          estadoDatos.className = "estado error";
          console.error("Error carga productos:", error.message);
          return;
        }

        estadoDatos.textContent = "‚úÖ Productos cargados correctamente.";
        estadoDatos.className = "estado ok";

        lista.innerHTML = "";
        data.forEach(p => {
          const div = document.createElement("div");
          div.innerHTML = `<strong>${p.nombre}</strong> - ${p.descripcion} - $${p.precio}`;
          lista.appendChild(div);
        });

      } catch (err) {
        estadoConexion.textContent = "‚ùå Fallo inesperado en diagn√≥stico.";
        estadoConexion.className = "estado error";
        console.error("Fallo general:", err);
      }
    }

    window.onload = diagnosticoTotal;
  </script>
</body>
</html>
