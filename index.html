<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trivo Store</title>
    <link rel="stylesheet" href="style.css" />
    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      const supabaseUrl = "https://uzqmsbkjonitzhoxvajx.supabase.co";
      const supabaseKey ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6cW1zYmtqb250aXpob3h2YWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDY1NjYsImV4cCI6MjA2Mzg4MjU2Nn0.RtiBzB0k0qzFzsfgUZcIvW1eyu2VmVbEolCWQDkDwbU
      const supabase = createClient(supabaseUrl, supabaseKey);

      // Funci√≥n para cargar productos desde Supabase
      async function cargarProductos() {
        const { data, error } = await supabase.from("mercancilla").select("*");
        if (error) {
          console.error("Error al cargar productos:", error.message);
          return;
        }

        const contenedor = document.getElementById("productos");
        contenedor.innerHTML = ""; // limpiar contenido

        data.forEach((producto) => {
          const card = document.createElement("div");
          card.className = "producto";

          card.innerHTML = `
            <img src="${producto.imagen_url}" alt="${producto.nombre}" />
            <h3>${producto.nombre}</h3>
            <p>${producto.descripcion}</p>
            <span>$${producto.precio}</span>
          `;

          contenedor.appendChild(card);
        });
      }

      // Ejecutar carga de productos al iniciar
      document.addEventListener("DOMContentLoaded", () => {
        cargarProductos();
      });
    </script>
  </head>
  <body>
    <header>
      <h1>Trivo Store</h1>
      <nav>
        <button onclick="document.getElementById('seccion-publica').style.display='block'; document.getElementById('seccion-privada').style.display='none';">Tienda P√∫blica</button>
        <button onclick="document.getElementById('seccion-privada').style.display='block'; document.getElementById('seccion-publica').style.display='none';">Panel Privado</button>
      </nav>
    </header>

    <main>
      <!-- SECCI√ìN TIENDA P√öBLICA -->
      <section id="seccion-publica" style="display:block;">
        <h2>Productos disponibles</h2>
        <div id="productos" class="grid-productos">
          <!-- Aqu√≠ se cargar√°n los productos -->
        </div>
      </section>

      <!-- SECCI√ìN PRIVADA -->
      <section id="seccion-privada" style="display:none;">
        <h2>Subir nuevo producto</h2>
                <form id="form-subida">
          <label>
            Nombre del producto:
            <input type="text" id="nombre" required />
          </label>
          <label>
            Descripci√≥n:
            <textarea id="descripcion" required></textarea>
          </label>
          <label>
            Precio:
            <input type="number" id="precio" required />
          </label>
          <label>
            Categor√≠a:
            <input type="text" id="categoria" required />
          </label>
          <label>
            URL de imagen:
            <input type="url" id="imagen_url" required />
          </label>
          <button type="submit">Subir producto</button>
        </form>
        <hr />
        <h3>Subir con palabras clave (Autom√°tico)</h3>
        <button id="btn-drone-real">Subir Drone 4K</button>
        <button id="btn-patineta-real">Subir Patineta El√©ctrica</button>
        <button id="btn-audifonos-real">Subir Aud√≠fonos Bluetooth</button>
      </section>
    </main>

    <footer>
      <p>&copy; 2025 Trivo Store - Todos los derechos reservados</p>
    </footer>

    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      const supabaseUrl = "https://uzqmsbkjonitzhoxvajx.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6cW1zYmprb25pdHpob3h2YWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTg3NDU2MTgsImV4cCI6MjAxNDAyMTYxOH0.UbWJDbM7mY9MNyzW_XFJ5CNPyUKKVeGgx3vlz1q9mnE";
      const supabase = createClient(supabaseUrl, supabaseKey);

      // Subida manual
      const formulario = document.getElementById("form-subida");
      formulario.addEventListener("submit", async (e) => {
        e.preventDefault();

        const nuevo = {
          nombre: document.getElementById("nombre").value,
          descripcion: document.getElementById("descripcion").value,
          precio: document.getElementById("precio").value,
          categoria: document.getElementById("categoria").value,
          imagen_url: document.getElementById("imagen_url").value,
        };

        const { error } = await supabase.from("mercancilla").insert(nuevo);
        if (error) {
          alert("‚ùå Error al subir: " + error.message);
        } else {
          alert("‚úÖ Producto subido correctamente.");
          formulario.reset();
        }
      });

      // Subida autom√°tica con palabras clave
      async function subirMercancilla(palabraClave) {
        const url = `https://api.mercadolibre.com/sites/MLM/search?q=${encodeURIComponent(palabraClave)}`;
        const res = await fetch(url);
        const data = await res.json();
        const p = data.results[0];

        if (!p) {
          alert("‚ùå No se encontr√≥ el producto.");
          return;
        }

        const nuevo = {
          nombre: p.title,
          descripcion: "Importado desde MercadoLibre",
          precio: p.price.toString(),
          categoria: p.category_id || "sin_categoria",
          imagen_url: p.thumbnail
        };

        const { error } = await supabase.from("mercancilla").insert(nuevo);
        if (error) alert("‚ùå Error: " + error.message);
        else alert("‚úÖ Subido: " + p.title);
      }

      document.getElementById("btn-drone-real").addEventListener("click", () => subirMercancilla("drone 4K"));
      document.getElementById("btn-patineta-real").addEventListener("click", () => subirMercancilla("patineta el√©ctrica"));
      document.getElementById("btn-audifonos-real").addEventListener("click", () => subirMercancilla("aud√≠fonos bluetooth"));
    </script>
    <!-- PANEL PRIVADO (Protegido por contrase√±a) -->
<section id="panel-privado" style="display:none">
  <h2>Panel Privado üîí</h2>
  <button onclick="mostrarFormulario()">üì§ Subir producto manual</button>
  <button onclick="mostrarTienda()">üõçÔ∏è Ver tienda</button>
  <div id="contenido-privado"></div>
</section>

<!-- PANEL DE AUTENTICACI√ìN -->
<section id="login-panel">
  <h2>Iniciar sesi√≥n</h2>
  <input type="password" id="clave" placeholder="Ingresa la contrase√±a" />
  <button onclick="verificarAcceso()">Ingresar</button>
</section>

<!-- TIENDA P√öBLICA -->
<section id="tienda-publica" style="display:none">
  <h2>Tienda P√∫blica üõí</h2>
  <div id="productos-publicos" class="grid-productos"></div>
</section>

<script>
  // Mostrar formulario
  function mostrarFormulario() {
    document.getElementById("form-subida").scrollIntoView({ behavior: "smooth" });
  }

  // Mostrar tienda p√∫blica desde privado
  function mostrarTienda() {
    document.getElementById("tienda-publica").style.display = "block";
    document.getElementById("tienda-publica").scrollIntoView({ behavior: "smooth" });
  }

  // Login por contrase√±a (clave: Trivo2025)
  function verificarAcceso() {
    const clave = document.getElementById("clave").value;
    if (clave === "Trivo2025") {
      document.getElementById("panel-privado").style.display = "block";
      document.getElementById("login-panel").style.display = "none";
      cargarProductos(); // Cargar productos desde Supabase
    } else {
      alert("‚ùå Contrase√±a incorrecta.");
    }
  }

  // Mostrar productos p√∫blicos
  async function cargarProductos() {
    const { data, error } = await supabase.from("mercancilla").select("*").limit(20).order("id", { ascending: false });
    if (error) {
      alert("‚ùå Error al cargar productos: " + error.message);
      return;
    }

    const contenedor = document.getElementById("productos-publicos");
    contenedor.innerHTML = ""; // Limpiar

    data.forEach((p) => {
      const card = document.createElement("div");
      card.className = "producto-card";
      card.innerHTML = `
        <img src="${p.imagen_url}" alt="${p.nombre}" />
        <h4>${p.nombre}</h4>
        <p>${p.descripcion}</p>
        <strong>$${p.precio}</strong>
        <p><em>${p.categoria}</em></p>
      `;
      contenedor.appendChild(card);
    });
  }
</script>
   <!-- FORMULARIO PARA SUBIR PRODUCTO MANUALMENTE -->
<section id="form-subida" style="display:none; margin-top: 40px;">
  <h2>üìù Subir nuevo producto</h2>
  <input id="nombre" placeholder="Nombre del producto" /><br />
  <textarea id="descripcion" placeholder="Descripci√≥n del producto"></textarea><br />
  <input id="precio" placeholder="Precio ($)" /><br />
  <input id="categoria" placeholder="Categor√≠a" /><br />
  <input id="imagen_url" placeholder="URL de la imagen" /><br />
  <button onclick="subirProductoManual()">Subir producto</button>
</section>

<script>
  async function subirProductoManual() {
    const nuevo = {
      nombre: document.getElementById("nombre").value,
      descripcion: document.getElementById("descripcion").value,
      precio: document.getElementById("precio").value,
      categoria: document.getElementById("categoria").value,
      imagen_url: document.getElementById("imagen_url").value
    };

    const { error } = await supabase.from("mercancilla").insert(nuevo);
    if (error) {
      alert("‚ùå Error al subir: " + error.message);
    } else {
      alert("‚úÖ Producto subido correctamente.");
      limpiarFormulario();
      cargarProductos(); // Recarga productos actualizados
    }
  }

  function limpiarFormulario() {
    document.getElementById("nombre").value = "";
    document.getElementById("descripcion").value = "";
    document.getElementById("precio").value = "";
    document.getElementById("categoria").value = "";
    document.getElementById("imagen_url").value = "";
  }
</script> 
    <!-- TIENDA P√öBLICA (LISTADO DE PRODUCTOS) -->
<section id="tienda-publica" style="margin-top: 40px;">
  <h2>üõçÔ∏è Productos en tienda</h2>
  <div id="productos"></div>
</section>

<style>
  #productos {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }
  .producto {
    border: 1px solid #ccc;
    padding: 10px;
    width: 220px;
    background-color: #f9f9f9;
  }
  .producto img {
    max-width: 100%;
    height: auto;
  }
</style>

<script>
  async function cargarProductos() {
    const { data, error } = await supabase.from("mercancilla").select("*").order("id", { ascending: false });
    const contenedor = document.getElementById("productos");
    contenedor.innerHTML = "";

    if (error) {
      contenedor.innerHTML = "‚ùå Error cargando productos.";
      return;
    }

    for (const p of data) {
      const div = document.createElement("div");
      div.className = "producto";
      div.innerHTML = `
        <img src="${p.imagen_url}" alt="${p.nombre}" />
        <h3>${p.nombre}</h3>
        <p>${p.descripcion}</p>
        <p><strong>$${p.precio}</strong></p>
        <small>Categor√≠a: ${p.categoria}</small>
      `;
      contenedor.appendChild(div);
    }
  }

  window.addEventListener("load", cargarProductos);
</script>
    <!-- ZONA PRIVADA CON CONTRASE√ëA -->
<section id="zona-privada" style="margin-top: 40px;">
  <h2>üîí Zona Privada</h2>
  <input type="password" id="clave" placeholder="Introduce la contrase√±a" />
  <button onclick="verificarClave()">Ingresar</button>
  <div id="privado" style="display: none; margin-top: 20px;">
    <h3>üì¶ Subir producto manual</h3>
    <input type="text" id="nombreManual" placeholder="Nombre del producto" />
    <input type="text" id="descripcionManual" placeholder="Descripci√≥n" />
    <input type="text" id="precioManual" placeholder="Precio" />
    <input type="text" id="categoriaManual" placeholder="Categor√≠a" />
    <input type="text" id="imagenManual" placeholder="URL de imagen" />
    <button onclick="subirManual()">Subir producto manual</button>
  </div>
</section>

<script>
  const contrase√±aCorrecta = "Trivo2025";

  function verificarClave() {
    const clave = document.getElementById("clave").value;
    if (clave === contrase√±aCorrecta) {
      document.getElementById("privado").style.display = "block";
      alert("‚úÖ Acceso concedido.");
    } else {
      alert("‚ùå Contrase√±a incorrecta.");
    }
  }

  async function subirManual() {
    const nuevo = {
      nombre: document.getElementById("nombreManual").value,
      descripcion: document.getElementById("descripcionManual").value,
      precio: document.getElementById("precioManual").value,
      categoria: document.getElementById("categoriaManual").value,
      imagen_url: document.getElementById("imagenManual").value,
    };

    const { error } = await supabase.from("mercancilla").insert(nuevo);
    if (error) alert("‚ùå Error: " + error.message);
    else alert("‚úÖ Producto manual subido.");
  }
</script>

<!-- FIN DE SISTEMA -->
   <style>
  #diagnostico-supabase {
    position: fixed;
    top: 10px;
    right: 10px;
    background-color: rgba(0, 0, 0, 0.75);
    color: white;
    font-size: 14px;
    padding: 10px 15px;
    border-radius: 8px;
    z-index: 9999;
    font-family: Arial, sans-serif;
  }
  #diagnostico-supabase.ok {
    border-left: 5px solid #00ff99;
  }
  #diagnostico-supabase.error {
    border-left: 5px solid #ff4444;
  }
</style>

<div id="diagnostico-supabase" class="ok">
  üîÑ Verificando conexi√≥n...
</div>

<!-- Diagn√≥stico de Supabase y robot autom√°tico -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const diagnostico = document.getElementById("diagnostico-supabase");

  const supabaseUrl = "https://uzqmsbkjontizhoxvajx.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6cW1zYmtqb250aXpob3h2YWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDY1NjYsImV4cCI6MjA2Mzg4MjU2Nn0.RtiBzB0k0qzFzsfgUZcIvW1eyu2VmVbEolCWQDkDwbU";

  const supabase = createClient(supabaseUrl, supabaseKey);

  async function verificarSupabase() {
    try {
      const { error } = await supabase.from("mercancilla").select("*").limit(1);
      if (error) throw error;

      diagnostico.innerHTML = "‚úÖ Supabase conectado correctamente";
      diagnostico.classList.remove("error");
      diagnostico.classList.add("ok");
    
      // Refuerzo para verificar si hay productos y si el robot responde
const { data: productos, error: errorProductos } = await supabase
  .from('mercancilla')
  .select('*');

if (errorProductos) {
  diagnostico.innerHTML += "<br>‚ö†Ô∏è Problema con el robot";
} else if (productos.length === 0) {
  diagnostico.innerHTML += "<br>üü° Conectado, pero sin productos cargados";
} else {
  diagnostico.innerHTML += "<br>‚úÖ Todo listo para subir productos";
}
    } catch (err) {
      diagnostico.innerHTML = "‚ùå Error de conexi√≥n<br>üîß Verifica tu API Key";
      diagnostico.classList.remove("ok");
      diagnostico.classList.add("error");
    }
  }

  async function subirMercancilla(palabraClave) {
    const url = `https://api.mercadolibre.com/sites/MLM/search?q=${encodeURIComponent(palabraClave)}`;
    const res = await fetch(url);
    const data = await res.json();
    const p = data.results[0];

    if (!p) {
      alert("‚ùå No se encontr√≥ el producto.");
      return;
    }

    const nuevo = {
      nombre: p.title,
      descripcion: "Importado desde MercadoLibre",
      precio: p.price.toString(),
      categoria: p.category_id || "sin_categoria",
      imagen_url: p.thumbnail
    };

    const { error } = await supabase.from("mercancilla").insert(nuevo);
    if (error) alert("‚ùå Error al subir: " + error.message);
    else alert("‚úÖ Subido correctamente: " + p.title);
  }

  // Botones de carga autom√°tica
  document.getElementById("btn-drone-real").addEventListener("click", () => subirMercancilla("drone 4K"));
  document.getElementById("btn-patineta-real").addEventListener("click", () => subirMercancilla("patineta el√©ctrica"));
  document.getElementById("btn-audifonos-real").addEventListener("click", () => subirMercancilla("aud√≠fonos bluetooth"));

  verificarSupabase();

</script>
<!-- Mini Refuerzo Diagn√≥stico Global -->

</script>
<!-- Diagn√≥stico visual del robot autom√°tico -->
<div id="diagnostico-supabase" class="verificando">üîÑ Verificando conexi√≥n...</div>

<style>
  #diagnostico-supabase {
    position: fixed;
    top: 10px;
    right: 10px;
    background-color: rgba(0, 0, 0, 0.75);
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 14px;
    font-family: Arial, sans-serif;
    z-index: 9999;
    max-width: 95%;
    white-space: pre-line;
  }

  #diagnostico-supabase.ok {
    background-color: #d4edda;
    color: #155724;
    border-left: 5px solid #00ff99;
  }

  #diagnostico-supabase.error {
    background-color: #f8d7da;
    color: #721c24;
    border-left: 5px solid #ff4444;
  }

  #diagnostico-supabase.verificando {
    background-color: #fff3cd;
    color: #856404;
    border-left: 5px solid #ffeeba;
  }
</style>

<script>
  async function subirMercancilla(palabraClave) {
    const diagnostico = document.getElementById('diagnostico-supabase');
    diagnostico.textContent = "ü§ñ Buscando producto: " + palabraClave;
    diagnostico.className = "verificando";

    const url = `https://api.mercadolibre.com/sites/MLM/search?q=${encodeURIComponent(palabraClave)}`;
    const res = await fetch(url);
    const data = await res.json();
    const p = data.results[0];

    if (!p) {
      diagnostico.textContent = "‚ùå No se encontr√≥ el producto.";
      diagnostico.className = "error";
      return;
    }

    const nuevo = {
      nombre: p.title,
      descripcion: "Importado desde MercadoLibre",
      precio: p.price.toString(),
      categoria: p.category_id || "sin_categoria",
      imagen_url: p.thumbnail
    };

    const { error } = await supabase.from("mercancilla").insert(nuevo);

    if (error) {
      diagnostico.textContent = "‚ùå Error al subir: " + error.message;
      diagnostico.className = "error";
    } else {
      diagnostico.textContent = "‚úÖ Producto subido correctamente: " + p.title;
      diagnostico.className = "ok";
    }
  }
</script>
    <!-- üîç Diagn√≥stico Total de la Tienda -->
<div id="diagnostico-avanzado" class="verificando">üîÑ Iniciando diagn√≥stico...</div>

<style>
  #diagnostico-avanzado {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #222;
    color: #fff;
    padding: 15px;
    border-radius: 10px;
    font-family: Arial, sans-serif;
    font-size: 14px;
    z-index: 9999;
    max-width: 90%;
    white-space: pre-line;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
  }
  #diagnostico-avanzado.ok { background-color: #d4edda; color: #155724; }
  #diagnostico-avanzado.error { background-color: #f8d7da; color: #721c24; }
  #diagnostico-avanzado.verificando { background-color: #fff3cd; color: #856404; }
</style>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const diagnostico = document.getElementById("diagnostico-avanzado");
  const supabaseUrl = "https://uzqmsbkjontizhoxvajx.supabase.co";
  const supabaseKey = "TU_API_KEY"; // ‚Üê Reemplaza si es necesario
  const supabase = createClient(supabaseUrl, supabaseKey);

  async function diagnosticoTienda() {
    diagnostico.textContent = "üîÑ Iniciando diagn√≥stico...";
    diagnostico.className = "verificando";
    let errores = [];

    // üîå Supabase
    try {
      const { data, error } = await supabase.from("mercancilla").select("*");
      if (error) errores.push("‚ùå Supabase: sin respuesta o error de conexi√≥n.");
      else {
        if (data.length === 0) errores.push("üü° Supabase conectado, pero sin productos.");
        else diagnostico.textContent += "\n‚úÖ Supabase conectado con productos.";
      }
    } catch {
      errores.push("‚ùå Error general al conectar con Supabase.");
    }

    // ü§ñ Robot autom√°tico
    if (!document.getElementById("btn-drone-real") ||
        !document.getElementById("btn-patineta-real") ||
        !document.getElementById("btn-audifonos-real")) {
      errores.push("‚ö†Ô∏è Botones del robot no encontrados.");
    }

    // üß™ Formularios
    const campos = ["nombre", "descripcion", "precio", "categoria", "imagen_url"];
    campos.forEach(id => {
      if (!document.getElementById(id)) errores.push(`‚ö†Ô∏è Campo faltante: ${id}`);
    });

    // Resultado
    if (errores.length === 0) {
      diagnostico.textContent = "‚úÖ Todo correcto. Sistema operativo y listo.";
      diagnostico.className = "ok";
    } else {
      diagnostico.textContent = errores.join("\n");
      diagnostico.className = "error";
    }
  }

  setTimeout(diagnosticoTienda, 4000); // Espera 4s tras cargar la p√°gina
</script>
</body>
</html>
  
