<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>üõí Trivo Store</title>
  <style>
    body { font-family: sans-serif; background: #fff; padding: 20px; color: #333; }
    h1 { color: #BA02E2; }
    .seccion { margin-bottom: 20px; }
    .error { color: red; font-weight: bold; }
    .ok { color: green; font-weight: bold; }
    .diagnostico { font-size: 14px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>üê±‚ÄçüöÄ Trivo Store</h1>

  <div class="seccion">
    <strong>üì∂ Estado de Conexi√≥n:</strong>
    <span id="estado-conexion">Verificando conexi√≥n...</span>
  </div>

  <div class="seccion">
    <strong>üõçÔ∏è Productos Disponibles</strong>
    <div id="productos">Cargando productos...</div>
  </div>

  <div class="seccion">
    <strong>üîê Panel Privado (Contrase√±a: trivo2025)</strong><br />
    <input type="password" id="clave" placeholder="Introduce la contrase√±a" />
    <button onclick="acceder()">Entrar</button>
    <div id="panel" style="display:none; margin-top:10px;">
      ‚úÖ Acceso concedido al panel privado
    </div>
  </div>

  <div class="seccion">
    <strong>üìä Diagn√≥stico T√©cnico:</strong>
    <div id="diagnostico" class="diagnostico">Iniciando diagn√≥stico...</div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://uzqmsbkjontizhovxajx.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6cW1zYmtqb250aXpob3h2YWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDY1NjYsImV4cCI6MjA2Mzg4MjU2Nn0.RtiBzB0k0qzFzsfgUZcIvW1eyu2VmVbEolCWQDkDwbU'
    const supabase = createClient(supabaseUrl, supabaseKey)

    const estadoConexion = document.getElementById('estado-conexion')
    const productosDiv = document.getElementById('productos')
    const diagnosticoDiv = document.getElementById('diagnostico')

    async function verificarConexion() {
      try {
        const { data, error } = await supabase.from('mercancilla').select('*').limit(1)
        if (error) throw error
        estadoConexion.innerHTML = "<span class='ok'>‚úÖ Conexi√≥n a Supabase exitosa.</span>"
        return true
      } catch (err) {
        estadoConexion.innerHTML = "<span class='error'>‚ùå Error de conexi√≥n a Supabase.</span>"
        diagnosticoDiv.innerHTML = `<span class='error'>Error: ${err.message}</span>`
        return false
      }
    }

    async function obtenerProductos() {
      try {
        const { data, error } = await supabase.from('mercancilla').select('*')
        if (error) throw error
        if (data.length === 0) {
          productosDiv.innerHTML = "<span class='error'>‚ùå No hay productos disponibles.</span>"
        } else {
          productosDiv.innerHTML = data.map(p => `üßæ ${p.nombre} ‚Äî $${p.precio}`).join('<br>')
        }
      } catch (err) {
        productosDiv.innerHTML = "<span class='error'>‚ùå Error al cargar productos.</span>"
        diagnosticoDiv.innerHTML = `<span class='error'>Error: ${err.message}</span>`
      }
    }

    function acceder() {
      const clave = document.getElementById('clave').value
      if (clave === "trivo2025") {
        document.getElementById('panel').style.display = "block"
      } else {
        alert("‚ùå Contrase√±a incorrecta")
      }
    }

    // Ejecutar diagn√≥stico autom√°tico
    verificarConexion().then(ok => {
      if (ok) {
        obtenerProductos()
      }
    })
  </script>
</body>
</html>
