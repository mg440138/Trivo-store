<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trivo Store</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    .producto {
      border: 1px solid #ccc;
      padding: 10px;
      width: 200px;
      background-color: #f9f9f9;
      margin: 10px;
    }
    .producto img {
      max-width: 100%;
      height: auto;
    }
    #productos-publicos {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }
    #diagnostico-avanzado {
      margin-top: 20px;
      font-weight: bold;
    }
    .ok {
      color: green;
    }
    .error {
      color: red;
    }
    .verificando {
      color: orange;
    }
  </style>
</head>
<body>

<h1>Trivo Store</h1>

<button onclick="location.reload()">Recargar P√°gina</button>

<div id="diagnostico-avanzado" class="verificando">üõ†Ô∏è Iniciando diagn√≥stico...</div>

<section style="margin-top: 30px;">
  <h2>üì¶ Productos cargados p√∫blicamente</h2>
  <div id="productos-publicos"></div>
</section>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const supabaseUrl = 'https://uzqmsbkjontizhovxajx.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'; // Reemplaza con tu key completa
  const supabase = createClient(supabaseUrl, supabaseKey);

  const diagnostico = document.getElementById("diagnostico-avanzado");

  async function cargarPublicos() {
    const contenedor = document.getElementById("productos-publicos");
    if (!contenedor) return;

    contenedor.innerHTML = "";

    const { data, error } = await supabase.from("mercancilla").select("*");

    if (error) {
      diagnostico.textContent = "‚ùå Error al obtener productos: " + error.message;
      diagnostico.className = "error";
      return;
    }

    if (!data || data.length === 0) {
      diagnostico.textContent = "‚ö†Ô∏è No hay productos disponibles.";
      diagnostico.className = "ok";
      return;
    }

    diagnostico.textContent = `‚úÖ ${data.length} producto(s) cargado(s) correctamente`;
    diagnostico.className = "ok";

    data.forEach((producto) => {
      const card = document.createElement("div");
      card.className = "producto";
      card.innerHTML = `
        <h3>${producto.nombre}</h3>
        <img src="${producto.imagen_url || 'https://via.placeholder.com/200'}" alt="${producto.nombre}" />
        <p><strong>Descripci√≥n:</strong> ${producto.descripcion}</p>
        <p><strong>Categor√≠a:</strong> ${producto.categoria}</p>
        <p><strong>Precio:</strong> $${producto.precio ?? "N/D"}</p>
      `;
      contenedor.appendChild(card);
    });
  }

  window.addEventListener("DOMContentLoaded", () => {
    diagnostico.textContent = "‚è≥ Verificando conexi√≥n con Supabase...";
    diagnostico.className = "verificando";
    cargarPublicos();
  });
</script>

</body>
</html>
