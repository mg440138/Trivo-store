
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diagnóstico Avanzado - Trivo Store</title>
    <style>
        body {
            background: #f5f5f5;
            font-family: monospace;
            padding: 2rem;
        }
        pre {
            white-space: pre-wrap;
            background: #fff;
            padding: 1rem;
            border-left: 4px solid #888;
        }
    </style>
</head>
<body>
    <h1>🔎 Diagnóstico Avanzado - Trivo Store</h1>
    <pre id="diagnostico">Iniciando diagnóstico...</pre>

    <script type="module">
        const diagnostico = document.getElementById("diagnostico");

        const supabaseUrl = "https://uzqmsbkjontizhovxajx.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6cW1zYmtqb250aXpob3h2YWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDY1NjYsImV4cCI6MjA2Mzg4MjU2Nn0.RtiBzB0k0qzFzsfgUZcIvW1eyu2VmVbEolCWQDkDwbU";
        const tableName = "mercancilla";

        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

        const supabase = createClient(supabaseUrl, supabaseKey);

        const ejecutarDiagnostico = async () => {
            try {
                const { data, error } = await supabase.from(tableName).select("*");

                if (error) {
                    diagnostico.innerText = "❌ ERROR al consultar Supabase:\n" + error.message;
                    console.error("Error:", error);
                    return;
                }

                if (!data || data.length === 0) {
                    diagnostico.innerText = "⚠️ Conexión exitosa, pero la tabla '" + tableName + "' está vacía.";
                    return;
                }

                diagnostico.innerText = "✅ Conexión a Supabase exitosa. Productos encontrados: " + data.length + "\n\n";
                data.forEach((item, index) => {
                    diagnostico.innerText += `#${index + 1}: ${item.nombre} (${item.categoria}) - $${item.precio}\n`;
                });

            } catch (err) {
                diagnostico.innerText = "🚫 Error inesperado:\n" + err.message;
                console.error("Excepción crítica:", err);
            }
        };

        ejecutarDiagnostico();
    </script>
</body>
</html>
