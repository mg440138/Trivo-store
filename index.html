
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trivo Store</title>
  <link rel="icon" type="image/png" href="https://fav.farm/üõí">
</head>
<body style="font-family: sans-serif; margin: 2rem;">

  <h1>üõçÔ∏è Trivo Store</h1>
  <div id="diagnostico-avanzado" style="margin-bottom: 1rem; padding: 1rem; border: 1px solid #ccc;">
    <p>üîç <strong>Iniciando diagn√≥stico...</strong></p>
    <div id="estado-supabase">üü° Verificando conexi√≥n con Supabase...</div>
    <div id="estado-productos">üü° Verificando productos...</div>
  </div>

  <section id="productos-publicos">
    <h2>üõí Productos Disponibles</h2>
    <ul id="lista-productos"></ul>
  </section>

  <section id="panel-privado" style="margin-top: 2rem;">
    <h2>üîê Panel Privado (Contrase√±a: trivo2025)</h2>
    <input type="password" id="clave" placeholder="Introduce la contrase√±a"/>
    <button onclick="mostrarFormulario()">Entrar</button>

    <div id="formulario" style="display:none; margin-top: 1rem;">
      <input type="text" id="nombre" placeholder="Nombre del producto" required/><br>
      <input type="number" id="precio" placeholder="Precio ($)" required/><br>
      <input type="text" id="categoria" placeholder="Categor√≠a" required/><br>
      <input type="url" id="imagen_url" placeholder="URL de la imagen" required/><br>
      <button onclick="subirProducto()">Subir Producto</button>
    </div>
  </section>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = "https://uzqmsbkjontizhovxajx.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6cW1zYmtqb250aXpob3h2YWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDY1NjYsImV4cCI6MjA2Mzg4MjU2Nn0.RtiBzB0k0qzFzsfgUZcIvW1eyu2VmVbEolCWQDkDwbU";
    const supabase = createClient(supabaseUrl, supabaseKey);

    const diagnostico = document.getElementById("diagnostico-avanzado");
    const estadoSupabase = document.getElementById("estado-supabase");
    const estadoProductos = document.getElementById("estado-productos");

    async function cargarProductos() {
      try {
        const { data, error } = await supabase.from("mercancilla").select("*");
        if (error) throw error;
        if (!data || data.length === 0) {
          estadoProductos.innerText = "‚ö†Ô∏è No se encontraron productos.";
        } else {
          estadoProductos.innerText = "‚úÖ Productos cargados correctamente.";
          const lista = document.getElementById("lista-productos");
          lista.innerHTML = "";
          data.forEach(prod => {
            const li = document.createElement("li");
            li.innerHTML = `<strong>${prod.nombre}</strong> - $${prod.precio} - ${prod.categoria}<br><img src="${prod.imagen_url}" alt="imagen" width="100"/>`;
            lista.appendChild(li);
          });
        }
      } catch (e) {
        estadoProductos.innerText = "‚ùå Error cargando productos: " + e.message;
      }
    }

    async function probarConexion() {
      try {
        const { error } = await supabase.from("mercancilla").select("*").limit(1);
        if (error) throw error;
        estadoSupabase.innerText = "‚úÖ Conexi√≥n exitosa con Supabase.";
        cargarProductos();
      } catch (e) {
        estadoSupabase.innerText = "‚ùå Error de conexi√≥n con Supabase: " + e.message;
      }
    }

    function mostrarFormulario() {
      const clave = document.getElementById("clave").value;
      if (clave === "trivo2025") {
        document.getElementById("formulario").style.display = "block";
      } else {
        alert("Contrase√±a incorrecta");
      }
    }

    async function subirProducto() {
      const nombre = document.getElementById("nombre").value;
      const precio = document.getElementById("precio").value;
      const categoria = document.getElementById("categoria").value;
      const imagen_url = document.getElementById("imagen_url").value;

      const { error } = await supabase.from("mercancilla").insert([{ nombre, precio, categoria, imagen_url }]);
      if (error) {
        alert("‚ùå Error al subir producto: " + error.message);
      } else {
        alert("‚úÖ Producto subido correctamente.");
        cargarProductos();
      }
    }

    probarConexion();
  </script>
</body>
</html>
