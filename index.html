
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Trivo Store</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .error { color: red; }
        .success { color: green; }
        .producto { margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
        .diagnostico { font-size: 0.9em; margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <h1><span style="color: purple;">üì¶ Trivo Store</span></h1>

    <div id="estado-conexion">üîÑ Verificando conexi√≥n...</div>

    <h2>üõí Productos Disponibles</h2>
    <div id="productos">üîÑ Cargando productos...</div>

    <h3>üîê Panel Privado (Contrase√±a: trivo2025)</h3>
    <input type="password" id="clave" placeholder="Introduce la contrase√±a" />
    <button onclick="entrarPrivado()">Entrar</button>

    <div id="panel-privado" style="display:none; margin-top: 20px;">
        <h3>‚úÖ Bienvenido al Panel Privado</h3>
        <p>Aqu√≠ ir√° tu panel de administraci√≥n.</p>
    </div>

    <h3>üß∞ Diagn√≥stico T√©cnico:</h3>
    <div id="diagnostico-avanzado" class="diagnostico">üîÑ Iniciando diagn√≥stico...</div>

    <script>
        const supabaseUrl = 'https://uzqmsbkjontizhovxajx.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzIiwicmVmIjoidXpxbXNia2pvbnRpemhvdnhhanh...
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        const productosDiv = document.getElementById('productos');
        const diagnosticoDiv = document.getElementById('diagnostico-avanzado');

        function entrarPrivado() {
            const clave = document.getElementById('clave').value;
            if (clave === 'trivo2025') {
                document.getElementById('panel-privado').style.display = 'block';
            } else {
                alert('‚ùå Contrase√±a incorrecta');
            }
        }

        async function verificarConexion() {
            try {
                const { data, error } = await supabase.from('mercancilla').select('id').limit(1);
                if (error) throw error;
                document.getElementById('estado-conexion').innerHTML = '‚úÖ Conexi√≥n establecida con Supabase.';
                diagnosticoDiv.innerHTML = '‚úÖ Supabase responde correctamente.';
            } catch (e) {
                document.getElementById('estado-conexion').innerHTML = '‚ùå Error al conectar con Supabase.';
                diagnosticoDiv.innerHTML = '‚ùå Fallo de conexi√≥n: ' + e.message;
            }
        }

        async function mostrarProductos() {
            try {
                const { data, error } = await supabase.from('mercancilla').select('*');
                if (error) throw error;

                if (data.length === 0) {
                    productosDiv.innerHTML = '‚ö†Ô∏è No hay productos disponibles. La tabla est√° vac√≠a.';
                    diagnosticoDiv.innerHTML += '<br>‚ö†Ô∏è No hay registros en la tabla "mercancilla"';
                } else {
                    productosDiv.innerHTML = '';
                    data.forEach(prod => {
                        const div = document.createElement('div');
                        div.className = 'producto';
                        div.innerHTML = `<strong>${prod.nombre}</strong><br>${prod.descripcion}<br><b>$${prod.precio}</b>`;
                        productosDiv.appendChild(div);
                    });
                    diagnosticoDiv.innerHTML += `<br>‚úÖ Se cargaron ${data.length} productos correctamente.`;
                }
            } catch (e) {
                productosDiv.innerHTML = '‚ùå Error al cargar productos.';
                diagnosticoDiv.innerHTML += '<br>‚ùå Error inesperado: ' + e.message;
            }
        }

        // Ejecutar al cargar
        verificarConexion().then(() => console.log("‚úÖ verificarConexion ejecutada."));
        mostrarProductos().then(() => console.log("‚úÖ mostrarProductos ejecutada."));
    </script>
</body>
</html>
