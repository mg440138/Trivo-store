
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Trivo Store Avanzado Diagn√≥stico Total</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 20px; }
    h1 { color: #333; }
    .producto { background: #fff; padding: 10px; margin-bottom: 10px; border-left: 4px solid #33c; }
    .error { background: #fee; color: #900; padding: 10px; border: 1px solid #900; margin-bottom: 10px; }
    .ok { background: #e0ffe0; padding: 10px; color: #060; border: 1px solid #060; margin-bottom: 10px; }
    #estadoConexion, #estadoDatos { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>üõ†Ô∏è Trivo Store ‚Äì Diagn√≥stico Total</h1>
  <div id="estadoConexion">‚è≥ Verificando conexi√≥n a Supabase...</div>
  <div id="estadoDatos">‚è≥ Esperando respuesta de datos...</div>
  <div id="lista-productos">Cargando productos...</div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabaseUrl = "https://uzqmsbkjontizhovxajx.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6cW1zYmtqb250aXpob3h2YWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDY1NjYsImV4cCI6MjA2Mzg4MjU2Nn0.RtiBzB0k0qzFzsfgUZcIvW1eyu2VmVbEolCWQDkDwbU";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function mostrarProductos() {
      const estado = document.getElementById("estadoConexion");
      const estadoDatos = document.getElementById("estadoDatos");
      const lista = document.getElementById("lista-productos");

      estado.textContent = "üîÑ Consultando Supabase...";
      lista.innerHTML = "<em>üïµÔ∏è Buscando productos en base de datos...</em>";

      try {
        const { data, error } = await supabase.from("mercancilla").select("*");

        if (error) {
          console.error("‚ùå Error Supabase:", error.message);
          estado.textContent = "‚ùå Error Supabase";
          estadoDatos.innerHTML = "<div class='error'>‚ùå Supabase dice: " + error.message + "</div>";
          return;
        }

        if (!data || data.length === 0) {
          estado.textContent = "‚ö†Ô∏è Conectado pero sin datos";
          estadoDatos.innerHTML = "<div class='error'>‚ö†Ô∏è No se encontraron productos</div>";
          return;
        }

        lista.innerHTML = "";
        data.forEach(p => {
          const div = document.createElement("div");
          div.className = "producto";
          div.innerHTML = `<strong>${p.nombre}</strong><br>${p.descripcion}<br>${p.precio} USD<br><img src="${p.imagen_url}" width="100">`;
          lista.appendChild(div);
        });

        estado.textContent = "‚úÖ Conectado a Supabase";
        estadoDatos.innerHTML = "<div class='ok'>‚úÖ Productos cargados correctamente</div>";
      } catch (err) {
        console.error("‚ùå Error general:", err.message);
        estado.textContent = "‚ùå Error general";
        estadoDatos.innerHTML = "<div class='error'>‚ùå Fallo inesperado: " + err.message + "</div>";
      }
    }

    function actualizarEstadisticas() {
      console.log("üìä Estad√≠sticas cargadas");
      // Aqu√≠ podr√≠as agregar m√°s estad√≠sticas o gr√°ficos si lo deseas
    }

    function mostrarProductosYEstadisticas() {
      mostrarProductos();
      actualizarEstadisticas();
    }

    window.onload = function () {
      mostrarProductosYEstadisticas();
    };
  </script>
</body>
</html>
