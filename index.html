
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Trivo Store Pro</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 20px; }
    h1 { color: #333; }
    .producto { background: #fff; padding: 10px; margin-bottom: 10px; border-left: 4px solid #33c; }
    .error { background: #ffe0e0; padding: 10px; color: #900; border: 1px solid #900; margin-bottom: 10px; }
    .ok { background: #e0ffe0; padding: 10px; color: #060; border: 1px solid #060; margin-bottom: 10px; }
    #estadoConexion { font-weight: bold; }
  </style>
</head>
<body>
  <h1>üõí Trivo Store ‚Äî Diagn√≥stico Avanzado</h1>
  <div id="estadoConexion">‚è≥ Verificando conexi√≥n a Supabase...</div>
  <div id="lista-productos">Cargando productos...</div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabaseUrl = "https://uzqmsbkjontizhovxajx.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6cW1zYmtqb250aXpob3h2YWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDY1NjYsImV4cCI6MjA2Mzg4MjU2Nn0.RtiBzB0k0qzFzsfgUZcIvW1eyu2VmVbEolCWQDkDwbU";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function mostrarProductos() {
      const lista = document.getElementById("lista-productos");
      lista.innerHTML = "<em>‚è≥ Buscando productos...</em>";
      document.getElementById("estadoConexion").textContent = "‚è≥ Consultando base de datos...";

      try {
        const { data, error } = await supabase.from('mercancilla').select('*');

        if (error) {
          console.error("‚ùå Error Supabase:", error.message);
          lista.innerHTML = "<div class='error'>‚ùå Error al cargar productos: " + error.message + "</div>";
          document.getElementById("estadoConexion").textContent = "‚ùå Error de conexi√≥n con Supabase.";
          return;
        }

        if (!data || data.length === 0) {
          lista.innerHTML = "<div class='error'>‚ö†Ô∏è Supabase conectado pero sin productos.</div>";
          document.getElementById("estadoConexion").textContent = "‚ö†Ô∏è Conexi√≥n OK pero sin datos.";
          return;
        }

        lista.innerHTML = "";
        data.forEach(p => {
          const div = document.createElement("div");
          div.className = "producto";
          div.innerHTML = `<strong>${p.nombre}</strong><br>${p.descripcion}<br>üí≤ ${p.precio}<br><img src="${p.imagen_url}" width="100"><hr>`;
          lista.appendChild(div);
        });

        document.getElementById("estadoConexion").textContent = "‚úÖ Conexi√≥n y carga exitosa de productos.";

      } catch (err) {
        console.error("‚ùå Error general:", err);
        lista.innerHTML = "<div class='error'>‚ùå Fallo general al mostrar productos: " + err.message + "</div>";
        document.getElementById("estadoConexion").textContent = "‚ùå Error inesperado: " + err.message;
      }
    }

    function actualizarEstadisticas() {
      console.log("üìä Estad√≠sticas activadas");
      // Aqu√≠ podr√≠as mostrar gr√°ficas, porcentajes o totales
    }

    function mostrarProductosYEstadisticas() {
      mostrarProductos();
      actualizarEstadisticas();
    }

    window.onload = function () {
      mostrarProductosYEstadisticas();
    };
  </script>
</body>
</html>
