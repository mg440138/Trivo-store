
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Diagn√≥stico Avanzado - Trivo Store</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f7f7f7;
            color: #333;
        }
        h1 {
            color: #8A2BE2;
        }
        .ok { color: green; }
        .fail { color: red; }
        .section {
            margin-bottom: 20px;
        }
        pre {
            background: #eee;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Diagn√≥stico T√©cnico Avanzado - Trivo Store</h1>
    <div class="section" id="estadoConexion">‚è≥ Verificando conexi√≥n a Supabase...</div>
    <div class="section" id="respuestaDiagnostico"></div>

    <script type="module">
        // Tu URL y API KEY p√∫blicas de Supabase (esto puedes modificarlo t√∫ luego)
        const SUPABASE_URL = "https://uzqmsbkjontizhovxajx.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6cW1zYmtqb250aXpob3h2YWp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzMDY1NjYsImV4cCI6MjA2Mzg4MjU2Nn0.RtiBzB0k0qzFzsfgUZcIvW1eyu2VmVbEolCWQDkDwbU";

        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        async function probarConexion() {
            try {
                const response = await supabase.from("mercancilla").select("*").limit(1);
                const estadoDiv = document.getElementById("estadoConexion");
                const diagnosticoDiv = document.getElementById("respuestaDiagnostico");

                if (response.error) {
                    estadoDiv.innerHTML = "üì° Estado de Conexi√≥n: <span class='fail'>‚ùå Error</span>";
                    diagnosticoDiv.innerHTML = `
                        <h3 class='fail'>Detalles del Error:</h3>
                        <pre>${JSON.stringify(response.error, null, 2)}</pre>
                        <p><strong>Explicaci√≥n:</strong> Puede ser que:</p>
                        <ul>
                            <li>‚ùå Tu tabla <code>mercancilla</code> no exista o est√© mal escrita.</li>
                            <li>üîë El API Key haya sido desactivado o reemplazado.</li>
                            <li>üîí Las reglas de RLS (Row Level Security) bloqueen los SELECT p√∫blicos.</li>
                            <li>üåê El dominio donde est√°s probando no est√© habilitado en Supabase.</li>
                        </ul>
                        <p><strong>Soluciones recomendadas:</strong></p>
                        <ol>
                            <li>Revisa que la tabla <code>mercancilla</code> exista y tenga datos.</li>
                            <li>Desactiva RLS en esa tabla (si no sabes c√≥mo, puedo ayudarte).</li>
                            <li>Revisa tu API Key y si es la "anon/public".</li>
                            <li>Verifica que el dominio actual est√© permitido en Supabase (en Settings > Auth > URL). Si est√°s usando Contabo, agrega la IP o dominio completo.</li>
                        </ol>
                    `;
                } else {
                    estadoDiv.innerHTML = "üì° Estado de Conexi√≥n: <span class='ok'>‚úÖ Correcta</span>";
                    diagnosticoDiv.innerHTML = `
                        <h3 class='ok'>Conexi√≥n exitosa ‚úÖ</h3>
                        <p>Se ha accedido a la tabla <code>mercancilla</code> correctamente.</p>
                        <p>Respuesta:</p>
                        <pre>${JSON.stringify(response.data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                document.getElementById("estadoConexion").innerHTML = "üì° Estado de Conexi√≥n: <span class='fail'>‚ùå Fall√≥ completamente</span>";
                document.getElementById("respuestaDiagnostico").innerHTML = `
                    <h3 class='fail'>Error JavaScript:</h3>
                    <pre>${error.message}</pre>
                    <p><strong>Posibles causas:</strong></p>
                    <ul>
                        <li>üîó No se puede cargar el m√≥dulo Supabase desde CDN (problemas de red o bloqueo).</li>
                        <li>üì¥ Tu dispositivo no tiene conexi√≥n a Internet.</li>
                        <li>üß± El navegador bloquea conexiones externas (modo seguro, restricciones, etc).</li>
                    </ul>
                `;
            }
        }

        probarConexion();
    </script>
</body>
</html>
